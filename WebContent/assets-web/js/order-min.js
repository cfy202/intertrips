Array.prototype.indexOf=function(b){for(var a=0;a<this.length;a++){if(this[a]==b){return a}}return -1};Array.prototype.remove=function(b){var a=this.indexOf(b);if(a>-1){this.splice(a,1)}};var beginDaysJsonCookieName="lastMonthFirstDayStringCookieName";var numberRule=/^\d{8,12}$/;var numberRul=/^[0-9]+$/;var reg=/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/;var init=0;var dateNumber=21;var chooseDepartureId;var isMobile=false;var chooseDepartureInfo="";var $departureSelect;var tabIsLocked=false;var viewLoaded=false;var departureLoaded=false;var imagesLoaded=false;$(function(){$(".panel-box").toggle(function(){$(this).addClass("collapsed").removeClass("panel-heading");$(this).next().stop(true,true).slideDown(300)},function(){$(this).addClass("panel-heading").removeClass("collapsed");$(this).next().stop(true,true).slideUp(300)});$(".pay_messages_steps").click(function(){$(this).next(".pay_messages_list_1").slideToggle("2000")});$(".itineraryTab").click(function(){$(this).next(".itineraryBody").slideToggle("2000")});var b=$("#mobileOptionalTourTab").find(".itineraryTabMobile");b.click(function(){currentIndex=b.index($(this));$body=$(this).next(".itineraryBodyMobile");if($body.is(":hidden")){b.each(function(i){if(i!=currentIndex){$(this).next(".itineraryBodyMobile").slideUp("2000")}});$body.slideDown("2000",function(){adjustMobileSroll($(this).closest(".timeline"))})}else{$body.slideUp("2000")}});var c=$("#mobileCustomTab").find(".itineraryTabMobile");c.click(function(){currentIndex=c.index($(this));$body=$(this).next(".itineraryBodyMobile");if($body.is(":hidden")){c.each(function(i){if(i!=currentIndex){$(this).next(".itineraryBodyMobile").slideUp("2000")}});$body.slideDown("2000",function(){adjustMobileSroll($(this).closest(".timeline"))})}else{$body.slideUp("2000")}});var a=$("#includeTable");var d=$("#notIncludeTable");var e=$("#mobileIncludeTable");var f=$("#mobileNotIncludeTable");if(a.find("tr").size()==0){a.parent().parent().hide()}if(d.find("tr").size()==0){d.parent().parent().hide()}if(e.find("tr").size()==0){e.parent().parent().hide()}if(f.find("tr").size()==0){f.parent().parent().hide()}function g(j,l){for(var k=1;k<=l;k++){$("#star"+j+"-"+k).removeClass("no").find("i").removeClass("fa-star-o").addClass("fa-star")}for(var k=l+1;k<=5;k++){$("#star"+j+"-"+k).addClass("no").find("i").removeClass("fa-star").addClass("fa-star-o")}if(l==1){$("#star-tip"+j).html("Very Poor")}if(l==2){$("#star-tip"+j).html("Not that bad")}if(l==3){$("#star-tip"+j).html("Average")}if(l==4){$("#star-tip"+j).html("Good")}if(l==5){$("#star-tip"+j).html("Perfect")}$("#starsResult"+j).val(l)}function h(i){$("[id^=star"+i+"]").each(function(j){var k=$(this);k.click(function(){g(i,j+1)})})}h(1);h(2);$(window).scroll(function(){if(!viewLoaded){var j=$(window).scrollTop()+$(window).height();var i=$("#commentDiv").offset().top;if(i<j){goPage(1);viewLoaded=true}}});$("#submit").click(function(){var l=$("#commentform");var j=$("#title");var k=$("#reviewComment");var i=$("#reviewEmail");if(getMember()==null){alertWarn("Please login in.");return}if(j.val().trim()==""){alertWarn("Please fill in your title");j.focus();return}if(i.val().trim()==""){alertWarn("Please login in your email");i.focus();return}if(k.val().trim()==""){alertWarn("Please fill in your review.");k.focus();return}jQuery.ajax({url:l.attr("action"),data:l.serialize(),type:"POST",beforeSend:function(){},success:function(m){if(m>0){j.val("");k.val("");$("#star1-5").click();$("#star2-5").click();alertWarn("under review...")}}})});$(".departureDateDiv").click(function(){if(!departureLoaded){if($departureSelect.size()>0){addDepartureChange($departureSelect);$departureSelect.change()}else{var i;if(!isMobile){i=$("#windowDatesDiv")}else{i=$("#mobileDatesDiv")}chooseDepartureId="";chooseDepartureInfo="";fillInitDates(i,chooseDepartureId,dateNumber)}departureLoaded=true}});$(".galleryDiv").click(function(){if(!imagesLoaded){$(".galleryImage").append($(galleryImageHtml));imagesLoaded=true}})});var addDepartureChange=function(a){a.change(function(){var b=$(this).closest(".people-box").next().find(".dateMain");chooseDepartureId=$(this).val();chooseDepartureInfo=$(this).find("option:selected").html();if(init!=0){tabIsLocked=true}fillInitDates(b,chooseDepartureId,dateNumber)})};var fillInitDates=function(a,b,c){$.ajax({type:"post",async:false,url:basePath+"/front/tourlineDetails/getDepartureDatesByDeparture.do",data:{tourlineId:tourlineId,departureId:b,dateNumber:c},dataType:"html",success:function(d){a.empty();a.append($(d));a.find(".after_today_date").each(function(){$(this).mouseenter(function(){$(this).addClass("after_today_date_on")}).mouseleave(function(){$(this).removeClass("after_today_date_on")})});a.find("img.hotImg").attr("src",basePath+"/assets-web/images/hot.gif");if(init==1){$("#priceShow").html("");$("#dateInput").val("")}else{init=1}clearBeginDates();a.next().find(".lastMonth").hide();if(a.find("table").attr("ishasnext")==0){a.next().find(".nextMonth").hide();$(".choose-page").hide();}else{a.next().find(".nextMonth").show();$(".choose-page").show();}},error:function(d){},})};var lastMonth=function(c){var a=$(c).closest(".poeple-choose-btn").prev();var b=getBeginDate();$.ajax({type:"post",url:basePath+"/front/tourlineDetails/beforeDates.do",data:{tourlineId:tourlineId,departureId:chooseDepartureId,dateNumber:dateNumber,firstDateString:b},dataType:"html",success:function(d){a.empty();a.append($(d));a.find(".after_today_date").each(function(){$(this).mouseenter(function(){$(this).addClass("after_today_date_on")}).mouseleave(function(){$(this).removeClass("after_today_date_on")})});a.find("img.hotImg").attr("src",basePath+"/assets-web/images/hot.gif");showOrHideBeforeAndNext(a)},error:function(d){},})};var nextMonth=function(e){var c=$(e).closest(".poeple-choose-btn").prev();var b=c.find("table");var d=b.attr("beginDate");var a=b.attr("lastDate");storeBeginDate(d);$.ajax({type:"post",url:basePath+"/front/tourlineDetails/nextDates.do",data:{tourlineId:tourlineId,departureId:chooseDepartureId,dateNumber:dateNumber,lastDateString:a},dataType:"html",success:function(f){c.empty();c.append($(f));c.find(".after_today_date").each(function(){$(this).mouseenter(function(){$(this).addClass("after_today_date_on")}).mouseleave(function(){$(this).removeClass("after_today_date_on")})});c.find("img.hotImg").attr("src",basePath+"/assets-web/images/hot.gif");showOrHideBeforeAndNext(c)},error:function(f){},})};var ifHasBeforeDates=function(){var a=getCookie(beginDaysJsonCookieName);var b=JSON.parse(a);if(b.length>0){return true}else{return false}};var clearBeginDates=function(){var b=new Array();var a=JSON.stringify(b);addCookie(beginDaysJsonCookieName,a,{path:"/"})};var getBeginDate=function(){var a=getCookie(beginDaysJsonCookieName);var b;var c;if(a!=null&&a!=""){b=JSON.parse(a);c=b.pop();a=JSON.stringify(b);addCookie(beginDaysJsonCookieName,a,{path:"/"});return c}else{window.location.href=window.location.href;return}};var storeBeginDate=function(c){var a=getCookie(beginDaysJsonCookieName);var b;if(a!=null&&a!=""){b=JSON.parse(a)}else{b=new Array()}b.push(c);a=JSON.stringify(b);addCookie(beginDaysJsonCookieName,a,{path:"/"})};var showOrHideBeforeAndNext=function(a){if(ifHasBeforeDates()){a.next().find(".lastMonth").show()}else{a.next().find(".lastMonth").hide()}if(a.find("table").attr("ishasnext")==0){a.next().find(".nextMonth").hide()}else{a.next().find(".nextMonth").show()}};var adjustTotalNumber=function(b,a){var c=$(b).val();if(c<a){$(b).val(a)}};function goPage(a){$.ajax({type:"POST",url:basePath+"/front/tourlineDetails/getReview.do",dataType:"json",data:{productId:productId,costnumber:costnumber,pageNow:a},success:function(b){$("#commentDiv").html(b[0]+b[1])},error:function(b){},})}var addWarnningShow=function(a){a.addClass("pay_mess_input_error");a.focus(function(){$(this).removeClass("pay_mess_input_error")})};var formatNumber=function(e,j){var m=e?e.toString().split("."):["0"];var a=j?j.split("."):[""];var h="";var k=m[0];var b=a[0];var d=k.length-1;var n=false;for(var g=b.length-1;g>=0;g--){switch(b.substr(g,1)){case"#":if(d>=0){h=k.substr(d--,1)+h}break;case"0":if(d>=0){h=k.substr(d--,1)+h}else{h="0"+h}break;case",":n=true;h=","+h;break}}if(d>=0){if(n){var c=k.length;for(;d>=0;d--){h=k.substr(d,1)+h;if(d>0&&((c-d)%3)==0){h=","+h}}}else{h=k.substr(0,d+1)+h}}h=h+".";k=m.length>1?m[1]:"";b=a.length>1?a[1]:"";d=0;for(var g=0;g<b.length;g++){switch(b.substr(g,1)){case"#":if(d<k.length){h+=k.substr(d++,1)}break;case"0":if(d<k.length){h+=k.substr(d++,1)}else{h+="0"}break}}return h.replace(/^,+/,"").replace(/\.$/,"")};var formatPrice=function(a){return formatNumber(a,"#,##0.##")};var cancelFormat=function(a){var b=a.split(",");if(b.length==2){a=b[0]+b[1]}return a};var adjustMobileSroll=function(a){scrollTop=a.offset().top-74;$("html,body").animate({scrollTop:scrollTop},200)};function AdditionalProductFee(c,d,a,e,b){this.productId=c;this.productName=d;this.unitcost=a;this.quantity=e;this.totalFee=b};
